apiVersion: batch/v1
kind: Job
metadata:
  name: smoke-gateway
  namespace: smoke
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: curl
          image: curlimages/curl:8.10.1
          args:
            - sh
            - -lc
            - |
              set -e
              H="${SMOKE_HOST:-example.local}"
              echo "Hitting http://istio-ingressgateway.istio-ingress.svc.cluster.local/ Host:$H"
              curl -sS -H "Host: $H" --max-time 10 http://istio-ingressgateway.istio-ingress.svc.cluster.local/ | head -n 3
